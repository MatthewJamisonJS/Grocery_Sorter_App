#!/usr/bin/env ruby

# Grocery Sorter App - Smart Launcher
# This script automatically handles setup and launches the app

require 'fileutils'

class GrocerySorterLauncher
  def initialize
    @config_dir = File.join(Dir.pwd, 'config')
    @client_secrets_path = File.join(@config_dir, 'client_secrets.json')
    @tokens_path = File.join(@config_dir, 'tokens.yaml')
  end

  def launch
    puts "🛒 Grocery Sorter App"
    puts "=" * 30

    # Check if setup is needed
    if setup_needed?
      puts "🔧 First-time setup detected..."
      puts "   Running setup wizard..."
      puts ""

      # Run the setup script
      system("ruby script/setup.rb")

      # Check if setup was successful
      unless setup_complete?
        puts ""
        puts "❌ Setup incomplete. Please run: ruby script/setup.rb"
        exit 1
      end

      puts ""
      puts "✅ Setup complete! Launching app..."
      puts ""
    end

    # Launch the main app
    puts "🚀 Starting Grocery Sorter App..."
    system("ruby script/grocery_sorter.rb")
  end

  private

  def setup_needed?
    !File.exist?(@client_secrets_path) || !File.exist?(@tokens_path)
  end

  def setup_complete?
    File.exist?(@client_secrets_path) && File.exist?(@tokens_path)
  end
end

# Run the launcher
if __FILE__ == $0
  launcher = GrocerySorterLauncher.new
  launcher.launch
end
